---
title: "CRUD„ÇíÂÆüË£Ö"
---

# „Åì„ÅÆÁ´†„Å´ÂØæÂøú„Åô„Çã„Ç≥„Éü„ÉÉ„Éà

* [üìù CRUD„ÇíÂÆüË£Ö](https://github.com/ttskch/symfony-example-app/commit/6fd12654a6158d04d4082c107418f406dee59ec6)

> „Éá„É¢„Ç¢„Éó„É™„ÅØÊó•Êú¨Ë™û„Å®Ëã±Ë™û„Å´ÂØæÂøú„Åô„Çã„Åü„ÇÅ„Åô„Åπ„Å¶„ÅÆÊñáÂ≠óÂàó„É™„ÉÜ„É©„É´„ÇíÁøªË®≥„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„Ç≥„Éü„ÉÉ„Éà„ÅÆÂÜÖÂÆπ„ÅØÊú¨Êñá„ÅÆËß£Ë™¨„Å®Ëã•Âπ≤Áï∞„Å™„Çä„Åæ„Åô„ÄÇ

# CRUD„ÇíÂÆüË£Ö

`Customer` „Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„Å®„ÄÅ„Åù„ÅÆÂ≠ê„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„Åß„ÅÇ„Çã `Person` „Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„Çí‰Ωú„Å£„Åü„ÅÆ„Åß„ÄÅÊ¨°„ÅØ `Customer` „ÅÆCRUD„ÇíÂÆüË£Ö„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ

## `make:crud` „Çí‰Ωø„ÅÜ„Åã„ÄÅÊó¢Â≠ò„ÅÆCRUD„Çí„Ç≥„Éî„Éö„Åô„Çã

`make:crud` „Çí‰Ωø„Åà„Å∞CRUD„ÅÆ„Åü„ÇÅ„ÅÆ„Ç≥„É≥„Éà„É≠„Éº„É©„Éª„Éï„Ç©„Éº„É†„Éª„ÉÜ„É≥„Éó„É¨„Éº„Éà„Çí‰∏ÄÊ∞ó„Å´Ëá™ÂãïÁîüÊàê„Åó„Å¶„Åè„Çå„Åæ„Åô„Åå„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆCRUD„Çí‰Ωú„ÇãÁ´†„Åß„ÇÇËø∞„Åπ„Åü„Å®„Åä„Çä„ÄÅÂÉï„ÅÆÂ†¥Âêà„ÅØËá™ÂãïÁîüÊàê„Åó„Åü„ÅÇ„Å®„Å´Êâã„Åß‰øÆÊ≠£„Åô„ÇãÈÉ®ÂàÜ„ÅåÂ§ö„ÅÑ„ÅÆ„ÅßÂü∫Êú¨ÁöÑ„Å´„ÅØÂà•„ÅÆ„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„ÅÆCRUD„ÅÆ„Ç≥„Éº„Éâ„Çí„Ç≥„Éî„Éö„Åó„Å¶„Åã„ÇâÊñáÂ≠óÂàó„ÅÆ‰∏ÄÊã¨ÁΩÆÊèõ„Å™„Å©„ÅßÂÜÖÂÆπ„ÇíÂ§âÊõ¥„Åó„Å¶„Éô„Éº„Çπ„Çí‰Ωú„Çã„Åì„Å®„ÅåÂ§ö„ÅÑ„Åß„Åô„ÄÇ

„Åì„ÅÆËæ∫„ÅØÂ•Ω„Åø„Å®„ÅÑ„ÅÜ„ÅãËá™ÂàÜ„ÅåÊ•Ω„Å™ÊñπÊ≥ï„Åß„ÇÑ„Çå„Å∞„ÅÑ„ÅÑ„Åã„Å™„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

## FormType

„Åæ„Åö„ÅØ `Person` `Customer` „Åù„Çå„Åû„Çå„ÅÆFormType„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ

```php
// src/Form/Customer/PersonType.php

class PersonType extends AbstractType
{
    public function buildForm(FormBuilderInterface $builder, array $options)
    {
        $builder
            ->add('fullName', TextType::class, [
                'label' => 'Ê∞èÂêç',
                'attr' => [
                    'required' => true,
                ],
                'label_attr' => [
                    'class' => 'required',
                ],
                'constraints' => [
                    new Assert\NotBlank(),
                ],
            ])
            ->add('email', EmailType::class, [
                'required' => false,
                'label' => '„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ',
            ])
            ->add('tel', TelType::class, [
                'required' => false,
                'label' => 'ÈõªË©±Áï™Âè∑',
            ])
            ->add('address', TextareaType::class, [
                'required' => false,
                'label' => '‰ΩèÊâÄ',
                'attr' => [
                    'rows' => 3,
                ],
            ])
        ;
    }

    public function configureOptions(OptionsResolver $resolver)
    {
        $resolver->setDefaults([
            'data_class' => Person::class,
        ]);
    }
}
```

`fullName` „Éï„Ç£„Éº„É´„Éâ„Å´ÂØæ„Åó„Å¶‰Ωï„ÇÑ„Çâ„Åî„Å°„ÇÉ„Åî„Å°„ÇÉ„ÇÑ„Å£„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ„Åì„Çå„Å´„Å§„ÅÑ„Å¶„ÅØ‰ª•‰∏ã„ÅÆÈÅéÂéªË®ò‰∫ã„ÅßËß£Ë™¨„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÅîÂèÇÁÖß„Åè„Å†„Åï„ÅÑüôè

> [[Symfony] „Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Éó„É≠„Éë„ÉÜ„Ç£„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Å´„Åä„ÅÑ„Å¶Â≠ê„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÂÅ¥„ÅÆNotBlankÂà∂Á¥Ñ„ÅåÁÑ°Ë¶ñ„Åï„Çå„Çã„Ç±„Éº„Çπ„Å´„Å§„ÅÑ„Å¶](https://zenn.dev/ttskch/articles/c596276f0d50d3)

```php
// src/Form/CustomerType.php

class CustomerType extends AbstractType
{
    private TranslatorInterface $translator;

    public function __construct(TranslatorInterface $translator)
    {
        $this->translator = $translator;
    }

    public function buildForm(FormBuilderInterface $builder, array $options)
    {
        $builder
            ->add('state', ChoiceType::class, [
                'label' => 'Áä∂ÊÖã',
                'choices' => array_combine(CustomerConstant::getValidStates(), CustomerConstant::getValidStates()),
                'multiple' => false,
                'placeholder' => '',
                'attr' => [
                    'data-placeholder' => 'ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                    'data-allow-clear' => true,
                    'class' => 'w-100',
                ],
            ])
            ->add('name', TextType::class, [
                'label' => 'È°ßÂÆ¢Âêç',
            ])
            ->add('people', CollectionType::class, [
                'required' => false,
                'entry_type' => PersonType::class,
                'label' => 'ÂÖàÊñπÊãÖÂΩìËÄÖ',
                'prototype' => true,
                'allow_add' => true,
                'allow_delete' => true,
            ])
        ;
    }

    public function configureOptions(OptionsResolver $resolver)
    {
        $resolver->setDefaults([
            'data_class' => Customer::class,
        ]);
    }
}
```

CollectionType„ÅÆ„Ç™„Éó„Ç∑„Éß„É≥„Åå„ÇÑ„ÇÑË§áÈõë„Åß„Åô„Åå„ÄÅ„Åì„Çå„Å´„Å§„ÅÑ„Å¶„ÇÇ‰ª•‰∏ã„ÅÆÈÅéÂéªË®ò‰∫ã„Çí„ÅîÂèÇÁÖß„Åè„Å†„Åï„ÅÑüôè

> [[Symfony/Form] CollectionType„ÅÆÂü∫Êú¨ÁöÑ„Å™‰Ωø„ÅÑÊñπ](https://zenn.dev/ttskch/articles/3e846a1aa5eb40)

`CustomerType` „ÅÆ `state` „Éï„Ç£„Éº„É´„Éâ„ÅÆ `choices` „Åå `CustomerConstant::getValidStates()` „ÇíÂºï„ÅÑ„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅÈÅ∏ÊäûËÇ¢„ÅåÂ¢óÊ∏õ„Åó„Å¶„ÇÇ `CustomerConstant` „ÇØ„É©„Çπ„Çí‰øÆÊ≠£„Åô„Çã„Å†„Åë„Åß„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„ÇÇFormType„ÇÇÂØæÂøúÂÆå‰∫Ü„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô„Å≠üëå

„Åì„ÅÆ„Åæ„Åæ„Åß„ÇÇÁâπ„Å´ÂïèÈ°å„ÅØ„Å™„ÅÑ„ÅÆ„Åß„Åô„Åå„ÄÅÂÉï„ÅØ„ÅÑ„Å§„ÇÇ„Åì„ÅÜ„ÅÑ„ÅÜÂÆöÊï∞ÈÅ∏ÊäûÁ≥ª„ÅÆ„Éï„Ç©„Éº„É†„Éï„Ç£„Éº„É´„Éâ„ÅØ„Åù„Çå„Åû„ÇåÂÄãÂà•„ÅÆFormType„Å®„Åó„Å¶ÂÆöÁæ©„Åó„Å¶„ÄÅÂà•„ÅÆ„Éï„Ç©„Éº„É†„Åß„ÅÑ„Å§„Åß„ÇÇ‰Ωø„ÅÑÂõû„Åõ„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

```php
// src/Form/Customer/StateChoiceType.php

class StateChoiceType extends ChoiceType
{
    public function configureOptions(OptionsResolver $resolver)
    {
        parent::configureOptions($resolver);

        $resolver->setDefaults([
            'choices' => array_combine(CustomerConstant::getValidStates(), CustomerConstant::getValidStates()),
            'multiple' => false,
            'placeholder' => '',
            'attr' => [
                'data-placeholder' => 'ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                'data-allow-clear' => true,
                'class' => 'w-100',
            ],
        ]);
    }
}
```

```diff
  // src/Form/CustomerType.php
  
  public function buildForm(FormBuilderInterface $builder, array $options)
  {
      $builder
-         ->add('state', ChoiceType::class, [
+         ->add('state', StateChoiceType::class, [
              'label' => 'Áä∂ÊÖã',
-             'choices' => array_combine(CustomerConstant::getValidStates(), CustomerConstant::getValidStates()),
-             'multiple' => false,
-             'placeholder' => '',
-             'attr' => [
-                 'data-placeholder' => 'ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
-                 'data-allow-clear' => true,
-                 'class' => 'w-100',
-             ],
          ])
          ->add('name', TextType::class, [
              'label' => 'È°ßÂÆ¢Âêç',
          ])
          ->add('people', CollectionType::class, [
              'required' => false,
              'entry_type' => PersonType::class,
              'label' => 'ÂÖàÊñπÊãÖÂΩìËÄÖ',
              'prototype' => true,
              'allow_add' => true,
              'allow_delete' => true,
          ])
      ;
  }
```

## „Ç≥„É≥„Éà„É≠„Éº„É©

Ê¨°„Å´„Ç≥„É≥„Éà„É≠„Éº„É©„ÇíÊõ∏„Åç„Åæ„Åô„ÄÇ

ÂÜÖÂÆπÁöÑ„Å´„ÅØ `make:crud` „Ç≥„Éû„É≥„Éâ„ÅßËá™ÂãïÁîüÊàê„Åó„Åü„Ç≥„Éº„Éâ„ÇíÂ§öÂ∞ëÊï¥ÂΩ¢„Åó„Å¶„ÄÅËá™‰Ωú„ÅÆ `ReturnToAwareControllerTrait` „ÇíÈÅ©Áî®„Åó„Åü„Çä„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„ÇíÂ∞éÂÖ•„Åó„Åü„Çä„Åô„Çã„Åê„Çâ„ÅÑ„Åß„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆCRUD„Çí‰Ωú„Å£„Åü„Å®„Åç„Å®„Åª„ÅºÂêå„Åò„Å™„ÅÆ„Åß„ÄÅË©≥Á¥∞„Å™Ë™¨Êòé„ÅØÂâ≤ÊÑõ„Åó„Åæ„Åôüôè

ÊúÄÁµÇÁöÑ„Å™„Ç≥„Éº„Éâ„ÅØ [„Åì„Çì„Å™ÊÑü„Åò](https://github.com/ttskch/symfony-example-app/blob/6fd12654a6158d04d4082c107418f406dee59ec6/src/Controller/CustomerController.php) „Å´„Å™„Çä„Åæ„Åô„ÄÇ

## „Éì„É•„Éº

ÊúÄÂæå„ÅØ„Éì„É•„Éº„ÅÆÂÆüË£Ö„Åß„Åô„ÄÇ

„Åì„Çå„ÇÇ„Åª„Å®„Çì„Å©„É¶„Éº„Ç∂„Éº„ÅÆCRUD„Çí‰Ωú„Å£„Åü„Å®„Åç„Å®Âêå„Åò„Åß„Åô„Åå„ÄÅ‰∏ÄÁÇπ„ÄÅ‰ªäÂõû„ÅØ„Éï„Ç©„Éº„É†„Å´ `allow_add` `allow_delete` „Å™CollectionType„Çí‰Ωø„Å£„Åü„ÅÆ„Åß„ÄÅ„Éï„É≠„É≥„ÉàÂÅ¥„ÅßÂ§öÂ∞ë„ÅÆDOMÊìç‰Ωú„ÅåÂøÖË¶Å„Å´„Å™„Çä„Åæ„Åô„ÄÇ

„Åì„ÅÆËæ∫„Çä„ÅÆÂá¶ÁêÜ„ÅØÊØéÂõûÊõ∏„Åè„ÅÆ„ÅØÈù¢ÂÄí„Åè„Åï„Åô„Åé„Çã„ÅÆ„Åß„ÄÅ„ÅÑ„Å§„Åß„ÇÇ‰Ωø„ÅÑÂõû„Åõ„Çã„Çà„ÅÜ„Å´ÈÉ®ÂìÅÂåñ„Åó„Å¶„Åä„Åç„Åæ„Åô„ÄÇ

```twig
{% macro template(form) %}
  {% set wrap = form.children|length > 1 %}
  <div class="{% if wrap %}card mb-3{% endif %} collection-item">
    <div class="{% if wrap %}card-body mb-n3{% endif%} d-flex">
      <div class="flex-grow-1">
        {{ form_widget(form, {attr: {class: 'mb-2'}}) }}
      </div>
      <div class="ml-2">
        <button type="button" class="btn btn-sm btn-outline-secondary collection-item-remover">
          <i class="far fa-trash-alt"></i>
        </button>
      </div>
    </div>
  </div>
{% endmacro %}

<div class="form-collection">
  {% for childForm in form.children %}
    {{ _self.template(childForm) }}
  {% endfor %}

  <div class="placeholder"></div>
  <button type="button" class="btn btn-block btn-outline-secondary m-0 collection-item-adder"><i class="fa fa-plus"></i> ËøΩÂä†</button>
  <div class="prototype" data-prototype="{{ _self.template(form.vars.prototype)|e }}" data-last-index="{{ form|length - 1 }}" data-required-num="{{ requiredNum ?? 0 }}"></div>
</div>
```

„Åì„Çì„Å™ÊÑü„Åò„ÅÆTwigÈÉ®ÂìÅ„Å®„ÄÅ

```js
import applySelect2 from '../lib/applySelect2';

ensureRemoverDisabled();

$(document).on('click', '.collection-item-adder', function () {
  const $prototype = $(this).closest('.form-collection').find('.prototype');
  const $placeholder = $(this).closest('.form-collection').find('.placeholder');

  let lastIndex = parseInt($prototype.data('last-index'));
  const html = $prototype.data('prototype').replace(/__name__/g, ++lastIndex);
  const $element = $(html);
  $placeholder.append($element);
  $prototype.data('lastIndex', lastIndex);

  applySelect2($element.find('select'));
  ensureRemoverDisabled();
});

$(document).on('click', '.collection-item-remover', function () {
  $(this).closest('.collection-item').remove();

  ensureRemoverDisabled();
});

function ensureRemoverDisabled() {
  $('.prototype').each(function () {
    const requiredNum = $(this).data('required-num');
    const $removers = $(this).closest('.form-collection').find('.collection-item-remover');

    if ($removers.length <= requiredNum) {
      $removers.prop('disabled', true);
    } else {
      $removers.prop('disabled', false);
    }
  });
}
```

Twig„ÅÆ„Éû„Éº„ÇØ„Ç¢„ÉÉ„Éó„Å´ÂØæÂøú„Åô„Çã„Åì„Çì„Å™ÊÑü„Åò„ÅÆJavaScript„ÅÆÂá¶ÁêÜ„ÇíÁî®ÊÑè„Åó„Å¶„Åä„Åç„Åæ„Åô„ÄÇ

> „Éû„Éº„ÇØ„Ç¢„ÉÉ„Éó„Å®JavaScript„ÅÆÂá¶ÁêÜ„ÅÆË™¨Êòé„ÅØ„Åì„Åì„Åß„ÅØÂâ≤ÊÑõ„Åó„Åæ„Åô„Åå„ÄÅ„ÇÑ„Å£„Å¶„ÅÑ„Çã„Åì„Å®„ÅØÂè§„ÅçËâØ„ÅçjQuery„Çí‰Ωø„Å£„Åü„Ç¥„É™„Ç¥„É™„ÅÆDOMÊìç‰Ωú„Å†„Åë„Å™„ÅÆ„Åß„Åù„Çì„Å™„Å´Èõ£„Åó„Åè„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çìüëå

JavaScript„Éï„Ç°„Ç§„É´„ÅØÂøò„Çå„Åö„Å´Webpack Encore„Ç®„É≥„Éà„É™„Éº„Å®„Åó„Å¶ËøΩÂä†„Åó„Å¶„Åä„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ

```diff
  Encore
+   .addEntry('widgets_form-collection', [
+     './assets/js/widgets/form-collection.js',
+   ])
```

„Åì„ÅÆ‰∏ä„Åß„ÄÅ `new.html.twig` „Å® `edit.html.twig` „Åß„ÅÆ„Åø

```twig
{% block javascripts %}
  {{ parent() }}
  {{ encore_entry_script_tags('widgets_form-collection') }}
{% endblock %}
```

„Å®„Åó„Å¶„Ç¢„Çª„ÉÉ„Éà„ÅÆË™≠„ÅøËæº„Åø„ÇíË°å„ÅÜ„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ

„Éï„Ç©„Éº„É†ÈÉ®ÂàÜ„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÅÆË®òËø∞„ÅØ„Åì„Çì„Å™ÊÑü„Åò„Å´„Å™„Çä„Åæ„Åô„ÄÇ

```twig
{{ form_start(form) }}
{{ form_errors(form) }}
{{ form_row(form.state) }}
{{ form_row(form.name) }}
<div class="form-group row">
  {{ form_label(form.people) }}
  <div class="col-sm-9">
    {% include 'widgets/form-collection.html.twig' with {
      form: form.people,
    } %}
  </div>
</div>
<div class="float-right">
  <button type="submit" class="btn btn-primary float-right ml-2">‰øùÂ≠ò</button>
  <a href="{{ cancelPath }}" class="btn btn-outline-secondary">„Ç≠„É£„É≥„Çª„É´</a>
</div>
{{ form_widget(form._token) }}
{{ form_end(form, {render_rest: false}) }}
```

## Âãï‰ΩúÁ¢∫Ë™ç

„Åì„Çå„Åß„ÄÅ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„ÅÑ„ÅÑÊÑü„Åò„Å™È°ßÂÆ¢„ÅÆCRUD„ÅåÂÆåÊàê„Åó„Åæ„Åó„Åüüôå

![](https://tva1.sinaimg.cn/large/0081Kckwgy1glwxxszwr3j327u0h83yu.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1glwxzdak04j327s0r8js9.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1glwxzxu6u8j31b20u0abc.jpg)
